<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta codeset="ASCII">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<link href="style.css" rel="stylesheet">
		<script src="jquery-1.10.2.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="bootstrap/js/bootstrap.min.js"></script>
		<title>Ввод пароля</title>

	</head>
	<body>
    
		<div id='waitDoor' class="container" style="display:none;">
			<div class="row">
				<div class="col-xs-12">
					<h1 class="text-center"><mark id='doorCloseTimeLeft'></mark> секунд для закрытия двери</h1>
				</div>
				<div class="col-xs-12">
					<h1 class="text-center">Состояние двери: <mark id='doorState1'></mark></h1>
				</div>
			</div>
		</div>
		
		<div id="mainScreen" class="container" style="display:none;">
			<div class="row">
				<div class="col-xs-12">
					<div class="panel panel-default">
						<div class="panel-heading"><h1 class="qqq-h1" id="objectName">Неизвестно</h1></div>
						<div class="panel-body">
							<div class="row">
								<div class="col-xs-12">
									<h1 class="">Состояние двери: <mark id='doorState'></mark></h1>
								</div>
								<div class="col-xs-12">
									<h1 class="">Состояние сигнализации: <mark id='alarmState'></mark></h1>
								</div>
								<div class="col-xs-12">
									<h1 class="" style="display:none;">Состояние ввода: <mark id='isWaitingForInput'></mark></h1>
								</div>
								<div class="col-xs-12">
									<h1 class="" style="display:none;">Ожидание закрытия двери: <mark id='doorWaiting'></mark></h1>
								</div>
								<div class="col-xs-12">
									<h1 class="" style="display:none;">Времени до закрытия двери: <mark id='doorCloseTimeLeft'></mark></h1>
								</div>
							</div>
							
							<div class="row">
								<div class="col-xs-12">&nbsp;</div>
							</div>
							
							<div class="row">
								<div class="col-xs-2"></div>
								<div class="col-xs-8">
									<button id='btnAlarmOff' onclick='manualOff()'  class="btn btn-default btn-lg btn-block btn-danger qqq-btn" type="submit">
										<p class="visible-lg-block">Отключить сигнализацию</p>
										<span class="glyphicon glyphicon glyphicon-off hidden-lg" aria-hidden="true"></span>
									</button>
								</div>
								<div class="col-xs-2"></div>
							</div>
							
							<div class="row">
								<div class="col-xs-2"></div>
								<div class="col-xs-8">
									<button id='btnAlarmOn' onclick="turnOn()"  class="btn btn-default btn-lg btn-block btn-success qqq-btn" type="submit">
										<p class="visible-lg-block">Включить сигнализацию</p>
										<span class="glyphicon glyphicon glyphicon glyphicon-off hidden-lg" aria-hidden="true"></span>
									</button>
								</div>
								<div class="col-xs-2"></div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>

			var socket = io();
			var manualTurnOff = false;
			function turnOff() {
				socket.emit('pin', $('#pin').html());
			}

			showingPinEnter = false;

			function manualOff() {
				manualTurnOff = true;
			}

			function turnOn() {
				socket.emit('alarmOn', 123);
			}

			socket.on('time', function (data) {
				$("#objectName").html(data.objectName);

				if (data.isWaitingForInput || manualTurnOff) {
					if (!showingPinEnter) {
						$('#pin').html('');
						$('#mainScreen').hide();
						$('#pinEnter').show();
						$('#waitDoor').hide();
						showingPinEnter = true;
					}
				} else {
					$('#pinEnter').hide();
					$('#mainScreen').show();
					$('#waitDoor').hide();
					showingPinEnter = false;
				}

				$('#leftSeconds').html(data.timeLeft);
				if (!data.doorState) {
					$('#doorState').html('Открыта');
					$('#doorState1').html('Открыта');
				} else {
					$('#doorState').html('Закрыта');
					$('#doorState1').html('Закрыта');
				}

				if (data.alarmState) {
					$('#btnAlarmOff').show();
					$('#btnAlarmOn').hide();
					$('#alarmState').html('Установлена');
				} else {
					$('#btnAlarmOn').show();
					$("#btnAlarmOff").hide();
					$('#alarmState').html('Снято');
					manualTurnOff = false;
					showingPinEnter = false;
				}
				$('#isWaitingForInput').html(data.isWaitingForInput);
				if (data.doorWaiting) {
					$('#waitDoor').show();
					$('#mainScreen').hide();
					$('#pinEnter').hide();
				}
				$('#doorWaiting').html(data.doorWaiting);
				$('#doorCloseTimeLeft').html(data.doorCloseTime);
			});

			socket.on('doorState', function (data) {
				$('#doorState').html(data);
			});

			socket.on('alarmState', function (data) {
				$('#alarmState').html(data);
			});
		</script>
		
		<div id='pinEnter' class="container" style="display:none;">
			<div class="row">
				<div class="col-xs-12">
					<div class="well">
						<div class="row">
							<div class="col-xs-2">
								<h1 class="qqq-h1 pull-right">Pin:</h1>
							</div>
							<div class="col-xs-8">
								<h1 id='pin' class="qqq-h1 text-muted"></h1>
							</div>
							<div class="col-xs-2">
								<h1 id="leftSeconds" class="qqq-h1 text-danger pull-left">60</h1>
								<h1 class="qqq-h1 text-danger pull-left">&nbsp;сек.</h1>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">&nbsp;</div>
			</div>
			<div class="row">
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >1</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >2</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >3</button></div>
			</div>
			<div class="row">
				<div class="col-xs-12">&nbsp;</div>
			</div>
			<div class="row">
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >4</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >5</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >6</button></div>
			</div>
			<div class="row">
				<div class="col-xs-12">&nbsp;</div>
			</div>
			<div class="row">
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >7</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >8</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >9</button></div>
			</div>
			<div class="row">
				<div class="col-xs-12">&nbsp;</div>
			</div>
			<div class="row">
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block btn-danger qqq-btn">C</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block qqq-btn" >0</button></div>
				<div class="col-xs-4" ><button class="key btn btn-default btn-lg btn-block btn-success qqq-btn" >Ok</button></div>
			</div>
			<div class="row">
				<div class="col-xs-4" ><span id="asd123"></span></div>
			</div>
			
		</div>
		
		<script>
		var i=0;
			$('.key').on("mouseover", function () {
				button_clicked($(this).html());
				i++;
				$("#asd123").html(i);
				$(this).mouseout();
			});
			function button_clicked(code) {
				code = code.trim();
				//alert(code);
				if (code == "Ok") {
					turnOff();
					return;
				}
				if (code == "C") {
					$('#pin').html('');
					return;
				}
				$('#pin').append(code);
			}
		</script>
</body>
</html>